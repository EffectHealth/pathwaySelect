<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drag & Drop Pathways (No Code Display, Show Pathway Link/Image)</title>
  <!-- Optional: Montserrat Black or any other font -->
  <link 
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" 
    rel="stylesheet"
  >
  <style>
    * {
      font-family: 'Montserrat', sans-serif;
      margin: 0; 
      padding: 0;
      box-sizing: border-box;
    }
    body {
      margin: 20px;
      color: #333;
    }
    h1, p {
      text-align: center;
      margin-bottom: 15px;
    }
    .row-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.row {
  display: flex;
  justify-content: center;
  gap: 40px; /* Space between placeholder wrappers */
}

.placeholder-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 80px; /* Ensures all wrappers have the same width */
}

.placeholder {
  width: 60px;
  height: 60px;
  border: 2px dotted #999;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.placeholder-label {
  font-weight: 900;
  font-size: 13px;
  color: #333;
  text-align: center;
  margin-top: 10px; /* Space between circle and label */
  line-height: 1.2;
}
    .placeholder-label span.weeks {
      font-weight: normal;
      color: #666;
    }
    .chip {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: move;
      user-select: none;
    }
    .chip img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      pointer-events: none; 
    }

/* Pathway display area */
#pathway-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px; /* Space between the two boxes */
  margin-top: 30px; /* Space from position rows */
}

#pathway-img-box {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 300px; /* Same size as max-width of the image */
  height: 170px; /* Adjusted for typical image aspect ratio */
  background: rgba(128, 128, 128, 0.5); /* 50% transparent gray */
  border-radius: 8px; /* Rounded corners */
  overflow: hidden; /* Prevent overflow of content */
}

#pathway-button-box {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 300px; /* Match the width of the button */
  height: 50px; /* Match the expected height of the button */
  background: rgba(128, 128, 128, 0.5); /* 50% transparent gray */
  border-radius: 8px; /* Rounded corners */
  overflow: hidden; /* Prevent overflow of content */
}

#pathway-img {
  display: block;
  width: 100%;
  height: auto;
  visibility: hidden; /* Initially hidden until loaded */
}

#pathway-button {
  display: block;
  text-decoration: none;
  font-weight: 900;
  color: white;
  background: #999966;
  padding: 10px 20px; /* Padding to style the button */
  border-radius: 6px;
  visibility: hidden; /* Initially hidden until loaded */
  transition: background 0.2s;
}

#pathway-button:hover {
  background: #285e8e;
}
/* General responsive design for small devices */
@media (max-width: 768px) {
  .row {
    flex-direction: row; /* Ensure rows remain horizontal */
    flex-wrap: wrap; /* Allow wrapping if content overflows */
    gap: 10px; /* Adjust spacing for smaller screens */
  }

  .placeholder-wrapper {
    width: auto; /* Allow placeholders to shrink if needed */
  }

  .placeholder {
    width: 50px;
    height: 50px;
  }

  .chip {
    width: 48px;
    height: 48px;
  }

  #pathway-display {
    gap: 10px;
    margin-top: 20px;
  }

  #pathway-img-box, #pathway-button-box {
    width: 100%; /* Use full width of the iframe */
    max-width: 300px;
    height: auto;
  }

  #pathway-button {
    font-size: 14px;
    padding: 8px 16px;
  }
}


  </style>
</head>
<body>


<div class="row-wrapper">
  <!-- ROW of ORIGINS (1,2,3,4) -->
  <div class="row">
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="origin1"></div>
      <div class="placeholder-label">Physical<br>Activity</div>
    </div>
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="origin2"></div>
      <div class="placeholder-label">Comprehensive<br>Nutrition</div>
    </div>
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="origin3"></div>
      <div class="placeholder-label">Restful<br>Sleep</div>
    </div>
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="origin4"></div>
      <div class="placeholder-label">Stress<br>Management</div>
    </div>
  </div>

  <!-- ROW of POSITIONS (a,b,c,d) -->
  <div class="row">
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="a"></div>
      <div class="placeholder-label">Semester 1<br><span class="weeks">(Weeks 1–13)</span></div>
    </div>
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="b"></div>
      <div class="placeholder-label">Semester 2<br><span class="weeks">(Weeks 14–26)</span></div>
    </div>
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="c"></div>
      <div class="placeholder-label">Semester 3<br><span class="weeks">(Weeks 27–29)</span></div>
    </div>
    <div class="placeholder-wrapper">
      <div class="placeholder" data-slot="d"></div>
      <div class="placeholder-label">Semester 4<br><span class="weeks">(Weeks 40–52)</span></div>
    </div>
  </div>
</div>

<!-- Pathway display area (two boxes: one for image, one for button) -->
<div id="pathway-display">
  <div id="pathway-img-box">
    <img id="pathway-img" src="" alt="Pathway Image">
  </div>
  <div id="pathway-button-box">
    <a id="pathway-button" href="#" target="_blank">Pathway Title</a>
  </div>
</div>

<script>
// (1) Data structures for valid slots, slot map, images for chips
const validSlots = {
  "1": ["origin1","a","b","c","d"],
  "2": ["origin2","a","b","c","d"],
  "3": ["origin3","a","b","c","d"],
  "4": ["origin4","a","b","c","d"]
};

const slotMap = {
  origin1: "1",
  origin2: "2",
  origin3: "3",
  origin4: "4",
  a: null,
  b: null,
  c: null,
  d: null
};

const images = {
  "1": "https://static.wixstatic.com/media/048b4b_bf890793ede846d1a9b50ac133ec7002~mv2.png",
  "2": "https://static.wixstatic.com/media/048b4b_54cca8d4592245788aa47d203da6c5a2~mv2.png",
  "3": "https://static.wixstatic.com/media/048b4b_cc7c6a363a9a4cdd93e298a2014b79ed~mv2.png",
  "4": "https://static.wixstatic.com/media/048b4b_a4c341c0ce1b4084bfb6adccb91045af~mv2.png"
};

// (2) Create chips initially
function createChip(num) {
  const div = document.createElement('div');
  div.classList.add('chip');
  div.dataset.letter = num;
  div.draggable = true;

  const img = document.createElement('img');
  img.src = images[num];
  div.appendChild(img);

  return div;
}

// Place 1..4 in origin1..origin4
["1","2","3","4"].forEach(num => {
  const slotId = "origin" + num;  
  const slotEl = document.querySelector(`[data-slot='${slotId}']`);
  const chipEl = createChip(num);
  slotEl.appendChild(chipEl);
});

// (3) Pathways dictionary for code lookup
const pathways = {
  "1234": {
    title: "Preventative Health: Foundation Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-foundation-pathway-1234",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/784/1735430581.original.png"
  },
  "1243": {
    title: "Preventative Health: Energy Flow Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-energy-flow-pathway-1243",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/790/1735430889.original.png"
  },
  "1324": {
    title: "Preventative Health: Balance Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-balance-pathway-1324",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/791/1735431019.original.png"
  },
  "1342": {
    title: "Preventative Health: Renewal Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-renewal-pathway-1342",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/793/1735431430.original.png"
  },
  "1423": {
    title: "Preventative Health: Vital Core Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-vital-core-pathway-1423",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/794/1735431673.original.png"
  },
  "1432": {
    title: "Preventative Health: Tranquility Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-tranquility-pathway-1432",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/795/1735431780.original.png"
  },
  "2134": {
    title: "Preventative Health: Wellness Anchor Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-wellness-anchor-pathway-2134",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/796/1735432010.original.png"
  },
  "2143": {
    title: "Preventative Health: Synergy Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-synergy-pathway-2143",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/797/1735432164.original.png"
  },
  "2314": {
    title: "Preventative Health: Harmony Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-harmony-pathway-2314",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/798/1735432274.original.png"
  },
  "2341": {
    title: "Preventative Health: Resilience Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-resilience-pathway-2341",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/799/1735432407.original.png"
  },
  "2413": {
    title: "Preventative Health: Empower Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-empower-pathway-2413",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/800/1735432527.original.png"
  },
  "2431": {
    title: "Preventative Health: Clarity Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-clarity-pathway-2431",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/801/1735432633.original.png"
  },
  "3124": {
    title: "Preventative Health: Dream Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-dream-pathway-3124",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/802/1735433070.original.png"
  },
  "3142": {
    title: "Preventative Health: Flow Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-flow-pathway-3142",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/803/1735433170.original.png"
  },
  "3214": {
    title: "Preventative Health: Thrive Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-thrive-pathway-3214",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/804/1735433258.original.png"
  },
  "3241": {
    title: "Preventative Health: Serenity Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-serenity-pathway-3241",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/805/1735433374.original.png"
  },
  "3412": {
    title: "Preventative Health: Adaptation Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-adaptation-pathway-3412",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/805/1735433374.original.png"
  },
  "3421": {
    title: "Preventative Health: Recovery Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-recovery-pathway-3421",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/807/1735433759.original.png"
  },
  "4123": {
    title: "Preventative Health: Strength Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-strength-pathway-4123",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/808/1735433900.original.png"
  },
  "4132": {
    title: "Preventative Health: Equilibrium Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-equilibrium-pathway-4132",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/809/1735433977.original.png"
  },
  "4213": {
    title: "Preventative Health: Resolve Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-resolve-pathway-4213",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/810/1735434253.original.png"
  },
  "4231": {
    title: "Preventative Health: Compass Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-compass-pathway-4231",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/811/1735434322.original.png"
  },
  "4312": {
    title: "Preventative Health: Endurance Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-endurance-pathway-4312",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/812/1735434427.original.png"
  },
  "4321": {
    title: "Preventative Health: Zenith Pathway",
    url: "https://preventativehealthcourse.effecttherapy.ca/bundles/preventative-health-zenith-pathway-4321",
    image: "https://files.cdn.thinkific.com/bundles/bundle_card_image_000/210/813/1735434511.original.png"
  }
};

// (4) Drag logic
let draggedChip = null;
let draggedLetter = null;
let oldSlot = null;
let didSuccessfulDrop = false;

function revertChip() {
  if (!draggedChip || !oldSlot) return;
  forceMoveChipToSlot(draggedChip, oldSlot, oldSlot);
  updatePathwayDisplay(); 
}

// Moves a chip from fromSlot to toSlot, handling occupant logic
function forceMoveChipToSlot(chipEl, fromSlot, toSlot) {
  if (!chipEl) return;
  const occupant = slotMap[toSlot];
  if (occupant && occupant !== chipEl.dataset.letter) {
    // remove occupant from DOM
    const occupantChip = document.querySelector(`[data-slot='${toSlot}'] .chip`);
    if (occupantChip) occupantChip.remove();
    // occupant goes home if fromSlot=origin & toSlot=position, else swap
    if (fromSlot.startsWith("origin") && ["a","b","c","d"].includes(toSlot)) {
      const occupantHome = "origin" + occupant;
      slotMap[toSlot] = null;
      forceMoveChipToSlot(occupantChip, toSlot, occupantHome);
    } else {
      forceMoveChipToSlot(occupantChip, toSlot, fromSlot);
    }
  }
  // place chipEl in toSlot
  const targetEl = document.querySelector(`[data-slot='${toSlot}']`);
  if (!targetEl) return;
  while (targetEl.firstChild) {
    targetEl.removeChild(targetEl.firstChild);
  }
  targetEl.appendChild(chipEl);
  slotMap[toSlot] = chipEl.dataset.letter;

  // clear oldSlot if it was the same chip
  if (slotMap[fromSlot] === chipEl.dataset.letter) {
    slotMap[fromSlot] = null;
  }
  reattachDragEvents(chipEl);
}

function reattachDragEvents(chip) {
  const clone = chip.cloneNode(true);
  chip.parentNode.replaceChild(clone, chip);
  addDragEvents(clone);
  return clone;
}

function addDragAndTouchEvents(chip) {
  chip.addEventListener("dragstart", (e) => {
    draggedChip = chip;
    draggedLetter = chip.dataset.letter;
    oldSlot = chip.parentElement.dataset.slot;
    didSuccessfulDrop = false;
  });

  chip.addEventListener("dragend", (e) => {
    if (!didSuccessfulDrop) {
      revertChip();
    }
    draggedChip = null;
    draggedLetter = null;
    oldSlot = null;
  });

  // Touch Events
  chip.addEventListener("touchstart", (e) => {
    e.preventDefault();
    draggedChip = chip;
    draggedLetter = chip.dataset.letter;
    oldSlot = chip.parentElement.dataset.slot;
    didSuccessfulDrop = false;
  });

  chip.addEventListener("touchmove", (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    draggedChip.style.position = "absolute";
    draggedChip.style.left = `${touch.pageX - 30}px`;
    draggedChip.style.top = `${touch.pageY - 30}px`;
  });

  chip.addEventListener("touchend", (e) => {
    e.preventDefault();
    const touch = e.changedTouches[0];
    const target = document.elementFromPoint(touch.pageX, touch.pageY);

    if (target && target.classList.contains("placeholder")) {
      const targetSlot = target.dataset.slot;
      if (validSlots[draggedLetter].includes(targetSlot)) {
        forceMoveChipToSlot(draggedChip, oldSlot, targetSlot);
        didSuccessfulDrop = true;
      }
    }
    draggedChip.style.position = "static";
    if (!didSuccessfulDrop) {
      revertChip();
    }
    draggedChip = null;
    draggedLetter = null;
    oldSlot = null;
  });
}

// Attach drag and touch events to all chips
document.querySelectorAll(".chip").forEach(addDragAndTouchEvents);

// attach drag events to the initial 4 chips
document.querySelectorAll(".chip").forEach(addDragEvents);

// Placeholder drop events
document.querySelectorAll(".placeholder").forEach(placeholder => {
  placeholder.addEventListener("dragover", e => {
    e.preventDefault();
    placeholder.classList.add("drag-over");
  });
  placeholder.addEventListener("dragleave", e => {
    placeholder.classList.remove("drag-over");
  });
  placeholder.addEventListener("drop", e => {
    e.preventDefault();
    placeholder.classList.remove("drag-over");
    if (!draggedChip) return;

    const targetSlot = placeholder.dataset.slot;
    if (targetSlot === oldSlot) {
      didSuccessfulDrop = false;
      return;
    }
    if (slotMap[targetSlot] === draggedLetter) {
      didSuccessfulDrop = false;
      return;
    }
    if (!validSlots[draggedLetter].includes(targetSlot)) {
      didSuccessfulDrop = false;
      return;
    }
    forceMoveChipToSlot(draggedChip, oldSlot, targetSlot);
    didSuccessfulDrop = true;
    updatePathwayDisplay(); 
  });
});

// If user drops outside placeholders => revert
document.addEventListener("drop", e => {
  // no preventDefault => triggers revert in dragend
}, false);

// (5) Update the displayed pathway (image + button) if all four positions are filled
function updatePathwayDisplay() {
  const code = [slotMap.a, slotMap.b, slotMap.c, slotMap.d].join("");
  const allFilled = slotMap.a && slotMap.b && slotMap.c && slotMap.d;

  const imgBoxEl = document.getElementById("pathway-img-box");
  const imgEl = document.getElementById("pathway-img");
  const buttonBoxEl = document.getElementById("pathway-button-box");
  const btnEl = document.getElementById("pathway-button");

  // Reset initial state (boxes remain visible but empty)
  imgEl.src = "";
  imgEl.style.visibility = "hidden";
  btnEl.style.visibility = "hidden";

  // If not all positions are filled, just show empty boxes
  if (!allFilled) {
    return;
  }

  // All positions are filled => check if code is in pathways
  const p = pathways[code];
  if (!p) {
    return;
  }

  // Found a match => show image and button
  imgEl.src = p.image;
  imgEl.style.visibility = "visible";
  btnEl.textContent = p.title;
  btnEl.href = p.url;
  btnEl.style.visibility = "visible";
}


// Initialize the display once
updatePathwayDisplay();
</script>
</body>
</html>
